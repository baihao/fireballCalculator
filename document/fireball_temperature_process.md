# 火球温度计算过程（基于“Modified temperature”）

## 1. 概述

依据实验图（`temperature.png`），采用“分段+平滑连接”的方法重建 Modified temperature 随时间的计算模型：
- 左段（0–t0）：三次多项式，描述升温到峰值阶段；
- 右段（≥t0）：拖曳（指数）衰减，描述峰后温度下降；
- 在交界处使用小范围 C1 平滑过渡，使温度与温度变化速率在视觉上大致平滑、物理合理。

时间单位为毫秒(ms)，温度单位为摄氏度(°C)。

## 2. 分段模型

### 2.1 左段：三次多项式（0 ≤ t ≤ t0）
```
T_up(t) = p3·t^3 + p2·t^2 + p1·t + p0
```
基于图像数字化的点（0, 20, 35 ms），最小二乘拟合得到（t 以 ms 计）：
- p3 = -2.2711014062e-03
- p2 = 1.1010535310e-03
- p1 = 3.8864194919e+00
- p0 = 1.1800000000e+03

由此可得：
- t0 = 35 ms
- T0 = T_up(t0) = 1220.00 °C
- dT0 = dT_up/dt|_{t0} ≈ -4.382804 °C/ms

### 2.2 右段：拖曳衰减（t ≥ t0）
```
T_drag(t) = A + (T0 - A) · exp( -k · (t - t0) )
```
通过对 (A, k) 联合搜索拟合右段（70, 105, 140 ms）得到：
- A = 510.755000 °C
- k = 0.010975 per ms

该形式保证峰值后单调下降，且长期趋近 A。

### 2.3 交界处平滑过渡（默认）
为避免交界处细小不连续或“折角”，在 t0 附近的宽度 w 内采用 C1 smoothstep 进行平滑连接：
```
s = clamp( (t - (t0 - w/2)) / w, 0, 1 )
S(s) = 3s^2 - 2s^3

T(t) = (1 - S) · T_up(t) + S · T_drag(t)
```
对应温度变化速率：
```
dT/dt = (1 - S) · dT_up/dt + S · dT_drag/dt + dS/dt · [ T_drag(t) - T_up(t) ]

dS/dt = (6s - 6s^2) / w
```
默认参数：
- w = 12 ms（可根据需要在 8–16 ms 间微调）

说明：若需要在 t0 处严格的一阶连续（数学意义上的 C1），可改用“c1 模式”（不使用平滑窗，直接令导数在 t0 连续，并按此确定 k）。本说明以默认的平滑过渡为准。

## 3. 综合公式
综合起来，默认模型为：
```
T(t) = (1 - S) · [ p3 t^3 + p2 t^2 + p1 t + p0 ]
     + S · [ A + (T0 - A) exp( -k (t - t0) ) ]
```
其中：
- S = 3s^2 - 2s^3，s = clamp((t - (t0 - w/2))/w, 0, 1)
- t0 = 35 ms，w = 12 ms
- p3, p2, p1, p0, A, k 如上所列

## 4. 典型数值（默认平滑参数）
根据脚本 `source/fireball_temperature_calculator.py` 最新运行结果：

- t = 0 ms：T ≈ 1180.00 °C，dT/dt ≈ 3.8864 °C/ms
- t = 20 ms：T ≈ 1240.00 °C，dT/dt ≈ 1.2051 °C/ms
- t = 35 ms：T ≈ 1220.00 °C，dT/dt ≈ -6.0834 °C/ms（过渡带内，近似平滑）
- t = 70 ms：T ≈ 993.78 °C，dT/dt ≈ -5.3012 °C/ms
- t = 105 ms：T ≈ 839.72 °C，dT/dt ≈ -3.6104 °C/ms
- t = 140 ms：T ≈ 734.80 °C，dT/dt ≈ -2.4588 °C/ms

全局拟合优度（对数字化点）：
- R² ≈ 0.996249

## 5. 使用说明
- 计算与作图：运行 `python source/fireball_temperature_calculator.py`
- 切换连接方式：
  - 默认 `mode='blend'`（大致平滑，尾部拟合更好）
  - 严格导数连续可用 `mode='c1'`
- 可根据需要调整 `blend_width_ms`（默认 12 ms），以平衡平滑程度与局部拟合

## 6. 注意事项
- 本模型基于图像读数的近似点进行拟合，数值有少量近似误差；若用于严谨分析，需使用原始实验数据重新拟合。
- 拟合区间建议 0–140 ms；区间外的外推误差可能较大。 